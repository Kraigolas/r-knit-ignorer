#!/bin/bash
#
# Unstage all .html and .pdf files that share the same basename as a .Rmd file
# which resides in the same directory, and add said files to the .gitignore 
stagedFiles=$(git diff --staged --name-only --diff-filter=A) 
IFS=$'\n'
for file in $stagedFiles; do 
    lower=$(echo $file | tr "[:upper:]" "[:lower:]")
    if [[ $lower == *.rmd ]]; then
        filename="${file%.*}"
        git restore --staged "$filename.pdf" 2>/dev/null 
        if [[ $? == 0 ]]; then 
            echo ignore-knit: Unstaging $filename.pdf 
		fi 
	git restore --staged "$filename.html" 2>/dev/null 
	    if [[ $? == 0 ]]; then 
	        echo ignore-knit: Unstaging $filename.html
		fi 
	echo ignore-knit: Adding $filename.pdf and $filename.html to .gitignore
        echo "
# generated by r-knit-ignorer
$filename.pdf
$filename.html" >> .gitignore 
    fi 
done 
